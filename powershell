param (
  [string]$version
)

$repoUrl = "http://10.1.96.4:8098/repository/static-repo/SimpleApp-$version.tar.gz"
$outputPath = "C:\\deployments\\SimpleApp.tar.gz"
$destinationPath = "C:\\inetpub\\wwwroot\\SimpleIISApp"

# Download .tar.gz file
Invoke-WebRequest -Uri $repoUrl -OutFile $outputPath

# Stop site to avoid conflicts (optional)
Import-Module WebAdministration
Stop-Website -Name "SimpleIISApp"

# Clear old files
Remove-Item -Recurse -Force "$destinationPath\\*" -ErrorAction SilentlyContinue

# Extract
tar -xzf $outputPath -C $destinationPath

# Start the site
Start-Website -Name "SimpleIISApp"
